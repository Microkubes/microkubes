<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>AWS with DynamoDB · Microkubes</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;p&gt;Minikube kubernetes cluster is recommended only for learning and test purposes. Below are instructions for creating production ready kubernetes cluster on AWS using Amazon&#x27;s managed kubernetes offering (AWS EKS) and DynamoDB backend.&lt;/p&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="AWS with DynamoDB · Microkubes"/><meta property="og:type" content="website"/><meta property="og:url" content="https://www.microkubes.com/index.html"/><meta property="og:description" content="&lt;p&gt;Minikube kubernetes cluster is recommended only for learning and test purposes. Below are instructions for creating production ready kubernetes cluster on AWS using Amazon&#x27;s managed kubernetes offering (AWS EKS) and DynamoDB backend.&lt;/p&gt;
"/><meta property="og:image" content="https://www.microkubes.com/img/microkubes-post-photo.png"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-134728683-1', 'auto');
              ga('send', 'pageview');
            </script><link rel="stylesheet" href="https://use.typekit.net/eaz5jri.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/microkubes-logo.svg" alt="Microkubes"/><h2 class="headerTitleWithLogo">Microkubes</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/installation-and-setup.html" target="_self">Docs</a></li><li class=""><a href="/help.html" target="_self">Support</a></li><li class=""><a href="/about.html" target="_self">About</a></li><li class=""><a href="https://github.com/Microkubes/microkubes/releases" target="_self">Download</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Microkubes Manual</span></h2></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Get Started with Microkubes</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/installation-and-setup.html">Get Started with Microkubes</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Microkubes Manual</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/introduction.html">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/installation.html">Installation</a></li><li class="navListItem"><a class="navItem" href="/docs/external-services.html">External Services</a></li><li class="navListItem"><a class="navItem" href="/docs/configuration.html">Configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/self-registration.html">Self Registration on Kong</a></li><li class="navListItem"><a class="navItem" href="/docs/security.html">Security</a></li><li class="navListItem"><a class="navItem" href="/docs/backends.html">Backends</a></li><li class="navListItem"><a class="navItem" href="/docs/deployments.html">Deployments</a></li><li class="navListItem"><a class="navItem" href="/docs/ci-cd.html">CI, CD, Code Quality</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/aws-eks.html">AWS with DynamoDB</a></li><li class="navListItem"><a class="navItem" href="/docs/gcp.html">GCP</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">AWS with DynamoDB</h1></header><article><div><span><p>Minikube kubernetes cluster is recommended only for learning and test purposes. Below are instructions for creating production ready kubernetes cluster on AWS using Amazon's managed kubernetes offering (AWS EKS) and DynamoDB backend.</p>
<p>For more details about EKS please visit <a href="https://docs.aws.amazon.com/eks/latest/userguide/getting-started.html">Getting Started with Amazon EKS</a></p>
<p>For more details about DynamoDB please visit <a href="https://aws.amazon.com/dynamodb/getting-started/">Getting Started with Amazon DynamoDB</a></p>
<h1><a class="anchor" aria-hidden="true" id="set-up-kubernetes-cluster-on-aws-eks"></a><a href="#set-up-kubernetes-cluster-on-aws-eks" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Set up Kubernetes cluster on AWS EKS</h1>
<p>We will use <a href="https://eksctl.io/">eksctl</a> tool for a simple kubernetes setup on EKS.</p>
<h2><a class="anchor" aria-hidden="true" id="prerequisites"></a><a href="#prerequisites" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Prerequisites</h2>
<ul>
<li><a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html">AWS CLI</a></li>
<li><a href="https://docs.aws.amazon.com/eks/latest/userguide/install-kubectl.html">kubectl</a></li>
<li><a href="https://eksctl.io/">eksctl</a></li>
</ul>
<p>To install the latest version of eksctl locally:</p>
<pre><code class="hljs css language-bash">curl --silent --location <span class="hljs-string">"https://github.com/weaveworks/eksctl/releases/download/latest_release/eksctl_<span class="hljs-variable">$(uname -s)</span>_amd64.tar.gz"</span> | tar xz -C /tmp
sudo mv /tmp/eksctl /usr/<span class="hljs-built_in">local</span>/bin
eksctl version
</code></pre>
<p>You will also need to have AWS CLI credentials configured. To create the configuration files for AWS on your machine, invoke <code>aws configure</code> and manually enter the requested data. For example:</p>
<pre><code class="hljs css language-bash">$ aws configure
AWS Access Key ID [None]: AKIAIOSFODNN7EXAMPLE
AWS Secret Access Key [None]: wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
Default region name [None]: us-west-2
Default output format [None]: json
</code></pre>
<p>This command generates a configuration file on your machine <code>~/.aws/credentials</code> we will use later to establish communication between Microkubes and DynamoDB.</p>
<h2><a class="anchor" aria-hidden="true" id="kubernetes-cluster-setup"></a><a href="#kubernetes-cluster-setup" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Kubernetes cluster Setup</h2>
<p>To get info about all available options of eksctl:</p>
<pre><code class="hljs css language-bash">eksctl --<span class="hljs-built_in">help</span>
</code></pre>
<p>To create kubernetes cluster with default parameters:</p>
<pre><code class="hljs css language-bash">eksctl create cluster --name=microkubes-cluster
</code></pre>
<p>When you execute <code>eksctl create cluster</code>, it will take care of creating the initial AWS Identity and Access Management (IAM) Role used to allow the master control plane to connect to EKS. It will then create the base Amazon VPC architecture, and then the master control plane. Once the control plane is active, it will create a node group to bring up instances, then deploy the ConfigMap that allows the nodes to join the cluster, and, finally, create a pre-configured kubeconfig that will give you access to the cluster. Also, a default StorageClass (gp2 volume type provisioned by EBS) will be added automatically.</p>
<p>To check if kubectl can connect to the new cluster:</p>
<pre><code class="hljs css language-bash">kubectl get nodes
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="backend-setup"></a><a href="#backend-setup" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Backend setup</h2>
<p>We will use Amazon DynamoDB as backend in this setup. DynamoDB is a fully managed NoSQL database service from Amazon.</p>
<p>Microkubes does the provisioning and configuration of the DynamoDB backend automatically. We just need to provide it with the AWS credentials file. We will do this later in this text.</p>
<h2><a class="anchor" aria-hidden="true" id="microkubes-setup-using-helm-charts"></a><a href="#microkubes-setup-using-helm-charts" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Microkubes setup using helm charts</h2>
<p>Helm chart for Microkubes is located at <a href="https://github.com/Microkubes/microkubes/tree/helm/kubernetes/helm/microkubes">https://github.com/Microkubes/microkubes/tree/helm/kubernetes/helm/microkubes</a></p>
<p>Examine the <a href="https://github.com/Microkubes/microkubes/blob/helm/kubernetes/helm/microkubes/values.yaml">values file</a> and make modifications if neccesary. Ingress is supported if enabled there.</p>
<h3><a class="anchor" aria-hidden="true" id="prerequisites-for-helm"></a><a href="#prerequisites-for-helm" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Prerequisites for helm</h3>
<ul>
<li>Kubernetes</li>
<li><a href="https://github.com/helm/helm/releases">Helm</a>
<ul>
<li>Make sure that you have helm tiller running in your cluster, if not run <code>helm init</code></li>
</ul></li>
<li>kubectl and kubeconfig configured correctly</li>
</ul>
<h4><a class="anchor" aria-hidden="true" id="create-keys-for-authorization-servers"></a><a href="#create-keys-for-authorization-servers" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Create keys for authorization servers</h4>
<pre><code class="hljs css language-bash">./keys/create.sh
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="create-secrets"></a><a href="#create-secrets" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Create secrets</h4>
<p>If you recall, earlier we used <code>aws configure</code> to generate <code>~/.aws/credentials</code>. We need this file inside our pod to be able to connect to DynamoDB. We include it with the other keys in microkubes-secrets:</p>
<pre><code class="hljs css language-bash">kubectl -n microkubes create secret generic microkubes-secrets \
    --from-file=keys/default \
    --from-file=keys/default.pub \
    --from-file=keys/private.pem \
    --from-file=keys/public.pub \
    --from-file=keys/service.cert \
    --from-file=keys/service.key \
    --from-file=keys/system \
    --from-file=keys/system.pub \
    --from-file=~/.aws/credentials
</code></pre>
<p>This will get it automatically mounted inside the pod together with the other secrets.</p>
<p>Make sure to update the values.yaml file of the helm chart and put the correct path to the newly mounted secret like:</p>
<pre><code class="hljs css language-yaml"><span class="hljs-attr">microkubes:</span>
<span class="hljs-attr">  database:</span> <span class="hljs-string">dynamodb</span>
<span class="hljs-attr">  awsDatabaseCredentials:</span> <span class="hljs-string">/run/secrets/microkubes/credentials</span>
  <span class="hljs-string">...</span>
</code></pre>
<p><code>awsDatabaseEndpoint</code> and <code>awsDatabaseRegion</code> don't have effect when we use credentials file and can be ignored.</p>
<h3><a class="anchor" aria-hidden="true" id="deploy-microkubes-on-kubernetes-cluster"></a><a href="#deploy-microkubes-on-kubernetes-cluster" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Deploy Microkubes on kubernetes cluster</h3>
<p>To deploy Microkubes on kubernetes cluster with the release name <code>&lt;release-name&gt;</code> within namespace <code>&lt;namespace-name&gt;</code>:</p>
<pre><code class="hljs css language-console"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">cd</span> kubernetes/helm</span>
<span class="hljs-meta">$</span><span class="bash"> helm dependency update microkubes/</span>
<span class="hljs-meta">$</span><span class="bash"> helm install microkubes/ --namespace &lt;namespace-name&gt; --name &lt;release-name&gt; \</span>
    --set postgresql.postgresUser=kong,postgresql.postgresPassword=&lt;secretpassword&gt;,postgresql.postgresDatabase=kong
</code></pre>
<p><strong>Note:</strong> PostgreSQL user should be <code>kong</code> and database name should also be <code>kong</code>.</p>
<p>The platform takes about 5 minutes to start, depending on your cluster power. You can follow the progress with <code>kubectl -n microkubes get pods -w</code>.
Once all services are running, you can start using microkubes.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/ci-cd.html"><span class="arrow-prev">← </span><span>CI, CD, Code Quality</span></a><a class="docs-next button" href="/docs/gcp.html"><span>GCP</span><span class="arrow-next"> →</span></a></div></div></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><div><h5>Docs</h5><a href="/docs/installation-and-setup.html">Getting Started</a><a href="/docs/introduction.html">Microkubes Manual</a></div><div><h5>Community</h5><a href="http://stackoverflow.com/questions/tagged/microkubes" target="_blank">Stack Overflow</a></div><div><h5>Social</h5><a class="github-button" href="https://github.com/Microkubes/microkubes" data-icon="octicon-star" data-count-href="/microkubes/microkubes/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a><div class="social"><a href="https://twitter.com/Microkubes" class="twitter-follow-button">Follow @Microkubes</a></div></div></section><section class="copyright">Copyright © 2019 <a href="https://www.keitaro.com/">Keitaro Inc.</a></section></footer></div><script>window.twttr=(function(d,s, id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return t;js=d.createElement(s);js.id=id;js.src='https://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js, fjs);t._e = [];t.ready = function(f) {t._e.push(f);};return t;}(document, 'script', 'twitter-wjs'));</script></body></html>